@{
    ViewBag.Title = "Test de Autoevaluación";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- ====== Estilos inline (solo visual) ====== -->
<style>
  /* Banner y contenido */
  #banner.banner { position: relative; min-height: 650px; }
  #banner .bg-color { min-height: 650px; }
  #banner .banner-info{
    position: relative;
    min-height: 60vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 80px 0 140px; /* aire inferior para flecha */
    text-align: center;
    z-index: 2;
  }
  #banner .btn-appoint{ margin-top: 12px; }
  #banner .overlay-detail{ position:absolute; left:50%; bottom:24px; transform:translateX(-50%); z-index:1; text-align:center; }
  #banner .overlay-detail a{ display:inline-block; padding:6px; line-height:1; }
  #banner .overlay-detail a i{ position:static !important; bottom:auto !important; margin:0; font-size:38px; color:#fff; }

  /* Anclas: suavizado y protección contra navbar fija */
  html { scroll-behavior: auto; }
  #autoevaluacion, #interpretacion, #faq { scroll-margin-top: 90px; }

  /* Tarjetas y bloques */
  .tm-feature { background:#fff; border:1px solid #eaeaea; border-radius:10px; padding:24px; margin-bottom:24px; box-shadow: 0 6px 16px rgba(0,0,0,.06); }
  .tm-feature .icon { font-size:36px; color:#0cb8b6; margin-bottom:10px; }
  .tm-feature h4 { margin:6px 0 10px; font-weight:600; }

  /* Test */
  .test-card { background:#fff; border:1px solid #e9ecef; border-radius:12px; padding:20px; box-shadow:0 6px 18px rgba(0,0,0,.05); }
  .test-card fieldset{ border:0; margin:0 0 14px; padding:0; }
  .test-card legend{ font-size:16px; font-weight:600; margin-bottom:10px; }
  .q-options{ display:flex; flex-wrap:wrap; gap:10px; }
  .q-options label{ background:#f7fbfb; border:1px solid #e0eded; border-radius:8px; padding:8px 12px; cursor:pointer; user-select:none; }
  .q-options input{ position:absolute; opacity:0; pointer-events:none; }
  .q-options input:checked + span{ font-weight:600; color:#0a7f7e; }

  /* Progreso */
  .tm-progress{ background:#e9f1f1; border-radius:999px; height:10px; width:100%; overflow:hidden; margin:10px 0 4px; }
  .tm-progress-bar{ height:100%; width:0%; background:#0cb8b6; transition:width .25s ease; }
  .tm-progress-text{ font-size:12px; color:#3a555a; }

  /* Resultado */
  .tm-result{ display:none; background:#ffffff; border:1px solid #eaeaea; border-radius:12px; padding:18px; margin-top:16px; box-shadow:0 6px 16px rgba(0,0,0,.06); }
  .tm-badge{ display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px; vertical-align:middle; }
  .badge-low{ background:#e8f7f5; color:#0b7c72; border:1px solid #bfe8e3; }
  .badge-mod{ background:#fff6e6; color:#8a5a06; border:1px solid #ffe0a6; }
  .badge-high{ background:#ffe8e8; color:#8a1d1d; border:1px solid #ffc9c9; }

  /* CTA final */
  #cta-test { background:#104a56; color:#fff; padding:50px 0; text-align:center; }
  #cta-test .btn-appoint{ background: rgba(12,184,182,0.95); }


</style>

<!-- ====== Banner ====== -->
<section id="banner" class="banner">
    <div class="bg-color">
        <div class="container">
            <div class="row">
                <div class="banner-info">
                    <div class="banner-logo text-center">
                        <img src="~/Content/img/logo.png" class="img-responsive" alt="Psicogestión">
                    </div>
                    <div class="banner-text text-center">
                        <h1 class="white">Test de Autoevaluación</h1>
                        <p class="white">Orientativo, rápido y confidencial. Conozca su estado emocional en minutos.</p>
                        <div class="btn-group" role="group" aria-label="Acciones test">
                            <a href="#autoevaluacion" class="btn btn-appoint" id="btn-empezar-test">Empezar test</a>
                            <a href="@Url.Action("Citas","Home")" class="btn btn-appoint" style="margin-left:8px; background:rgba(255,255,255,.2); border:1px solid rgba(255,255,255,.35);">Agendar cita</a>
                        </div>
                    </div>
                </div>
                <div class="overlay-detail text-center">
                    <a href="#autoevaluacion" id="arrow-test"><i class="fa fa-angle-down"></i></a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ====== Intro / Beneficios ====== -->
<section class="section-padding" id="intro">
    <div class="container">
        <div class="row">
            <div class="col-md-12"><h2 class="ser-title">¿Por qué realizarlo?</h2><hr class="botm-line"></div>
            <div class="col-md-4 col-sm-6">
                <div class="tm-feature text-center">
                    <div class="icon"><i class="fa fa-bolt"></i></div>
                    <h4>3–5 minutos</h4>
                    <p>Cuestionario breve con escala de frecuencia. Resultado inmediato.</p>
                </div>
            </div>
            <div class="col-md-4 col-sm-6">
                <div class="tm-feature text-center">
                    <div class="icon"><i class="fa fa-lock"></i></div>
                    <h4>Confidencial</h4>
                    <p>Su información no se comparte. Sirve como guía para usted.</p>
                </div>
            </div>
            <div class="col-md-4 col-sm-6">
                <div class="tm-feature text-center">
                    <div class="icon"><i class="fa fa-heart"></i></div>
                    <h4>Enfoque de bienestar</h4>
                    <p>Identifique señales tempranas y reciba recomendaciones de cuidado.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ====== Test ====== -->
<section id="autoevaluacion" class="section-padding" style="background:#f6fafb;">
    <div class="container">
        <div class="row">
            <div class="col-md-12"><h2 class="ser-title">Autoevaluación</h2><hr class="botm-line"></div>
            <div class="col-md-8 col-md-offset-2">
                <div class="test-card">
                    <p style="margin:0 0 12px; color:#5a6a6e;">
                        Marque la opción que mejor describe su experiencia en las <strong>últimas dos semanas</strong>.
                    </p>

                    <!-- Progreso -->
                    <div class="tm-progress"><div class="tm-progress-bar" id="tm-progress-bar"></div></div>
                    <div class="tm-progress-text"><span id="tm-progress-text">0%</span> completado</div>

                    <!-- Escala -->
                    <div style="margin: 12px 0 18px; font-size:13px; color:#51676b;">
                        Escala: 0 = Nunca · 1 = Rara vez · 2 = A menudo · 3 = Casi siempre
                    </div>

                    <!-- Preguntas -->
                    <form id="formTest" novalidate>
                        <!-- Q1 -->
                        <fieldset data-q="1">
                            <legend>1. Me he sentido nervioso/a, ansioso/a o al límite.</legend>
                            <div class="q-options">
                                <label><input type="radio" name="q1" value="0"><span>0</span></label>
                                <label><input type="radio" name="q1" value="1"><span>1</span></label>
                                <label><input type="radio" name="q1" value="2"><span>2</span></label>
                                <label><input type="radio" name="q1" value="3"><span>3</span></label>
                            </div>
                        </fieldset>
                        <!-- Q2 -->
                        <fieldset data-q="2">
                            <legend>2. He sentido poco interés o placer en hacer cosas.</legend>
                            <div class="q-options">
                                <label><input type="radio" name="q2" value="0"><span>0</span></label>
                                <label><input type="radio" name="q2" value="1"><span>1</span></label>
                                <label><input type="radio" name="q2" value="2"><span>2</span></label>
                                <label><input type="radio" name="q2" value="3"><span>3</span></label>
                            </div>
                        </fieldset>
                        <!-- Q3 -->
                        <fieldset data-q="3">
                            <legend>3. He tenido dificultad para conciliar o mantener el sueño.</legend>
                            <div class="q-options">
                                <label><input type="radio" name="q3" value="0"><span>0</span></label>
                                <label><input type="radio" name="q3" value="1"><span>1</span></label>
                                <label><input type="radio" name="q3" value="2"><span>2</span></label>
                                <label><input type="radio" name="q3" value="3"><span>3</span></label>
                            </div>
                        </fieldset>
                        <!-- Q4 -->
                        <fieldset data-q="4">
                            <legend>4. Me he sentido con poca energía o cansancio.</legend>
                            <div class="q-options">
                                <label><input type="radio" name="q4" value="0"><span>0</span></label>
                                <label><input type="radio" name="q4" value="1"><span>1</span></label>
                                <label><input type="radio" name="q4" value="2"><span>2</span></label>
                                <label><input type="radio" name="q4" value="3"><span>3</span></label>
                            </div>
                        </fieldset>
                        <!-- Q5 -->
                        <fieldset data-q="5">
                            <legend>5. He tenido dificultades para concentrarme.</legend>
                            <div class="q-options">
                                <label><input type="radio" name="q5" value="0"><span>0</span></label>
                                <label><input type="radio" name="q5" value="1"><span>1</span></label>
                                <label><input type="radio" name="q5" value="2"><span>2</span></label>
                                <label><input type="radio" name="q5" value="3"><span>3</span></label>
                            </div>
                        </fieldset>
                        <!-- Q6 -->
                        <fieldset data-q="6">
                            <legend>6. Me he sentido triste, deprimido/a o sin esperanza.</legend>
                            <div class="q-options">
                                <label><input type="radio" name="q6" value="0"><span>0</span></label>
                                <label><input type="radio" name="q6" value="1"><span>1</span></label>
                                <label><input type="radio" name="q6" value="2"><span>2</span></label>
                                <label><input type="radio" name="q6" value="3"><span>3</span></label>
                            </div>
                        </fieldset>
                        <!-- Q7 -->
                        <fieldset data-q="7">
                            <legend>7. Me he sentido irritable o con poca tolerancia.</legend>
                            <div class="q-options">
                                <label><input type="radio" name="q7" value="0"><span>0</span></label>
                                <label><input type="radio" name="q7" value="1"><span>1</span></label>
                                <label><input type="radio" name="q7" value="2"><span>2</span></label>
                                <label><input type="radio" name="q7" value="3"><span>3</span></label>
                            </div>
                        </fieldset>
                        <!-- Q8 -->
                        <fieldset data-q="8">
                            <legend>8. He evitado actividades o personas por ansiedad o desánimo.</legend>
                            <div class="q-options">
                                <label><input type="radio" name="q8" value="0"><span>0</span></label>
                                <label><input type="radio" name="q8" value="1"><span>1</span></label>
                                <label><input type="radio" name="q8" value="2"><span>2</span></label>
                                <label><input type="radio" name="q8" value="3"><span>3</span></label>
                            </div>
                        </fieldset>

                        <div style="display:flex; gap:10px; margin-top:14px;">
                            <button type="submit" class="btn btn-appoint">Ver resultado</button>
                            <button type="button" id="btnReset" class="btn btn-appoint" style="background:#8aa7ad; border:1px solid #78939a;">Reiniciar</button>
                        </div>
                    </form>

                    <!-- Resultado -->
                    <div class="tm-result" id="tm-result">
                        <h4 style="margin-top:0;">Resultado</h4>
                        <p style="margin:6px 0;">Puntaje total: <strong><span id="tm-score">0</span></strong> / 24 · Nivel: <span id="tm-level" class="tm-badge badge-low">Bajo</span></p>
                        <div id="tm-reco" style="margin-top:8px; color:#4a5b5f;"></div>
                        <div style="margin-top:12px;">
                            <a href="@Url.Action("Citas","Home")" class="btn btn-appoint">Agendar cita</a>
                            <a href="#interpretacion" class="site-link" style="margin-left:10px;">Cómo interpretar</a>
                        </div>
                        <p style="margin-top:12px; font-size:12px; color:#6b7c80;">Este test es orientativo y no sustituye una evaluación profesional. Si sus síntomas son intensos o persistentes, solicite apoyo clínico.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ====== Interpretación ====== -->
<section id="interpretacion" class="section-padding">
    <div class="container">
        <div class="row">
            <div class="col-md-12"><h2 class="ser-title">Interpretación del puntaje</h2><hr class="botm-line"></div>
            <div class="col-md-10 col-md-offset-1">
                <div class="tm-feature">
                    <ul class="quick-info" style="margin:0;">
                        <li><i class="fa fa-circle" style="font-size:8px;"></i> <strong>0–7 (Bajo):</strong> Señales leves o puntuales. Mantenga hábitos de autocuidado.</li>
                        <li><i class="fa fa-circle" style="font-size:8px;"></i> <strong>8–15 (Moderado):</strong> Considere acompañamiento profesional para explorar estrategias.</li>
                        <li><i class="fa fa-circle" style="font-size:8px;"></i> <strong>16–24 (Elevado):</strong> Recomendable evaluación clínica para un plan de apoyo personalizado.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- ====== FAQ ====== -->
<section id="faq" class="section-padding" style="background:#f6fafb;">
    <div class="container">
        <div class="row">
            <div class="col-md-12"><h2 class="ser-title">Preguntas frecuentes</h2><hr class="botm-line"></div>
            <div class="col-md-8 col-md-offset-2">
                <details class="tm-faq">
                    <summary>¿Este test hace un diagnóstico?</summary>
                    <p>No. Es orientativo. Sirve para reflexionar y decidir si desea apoyo profesional.</p>
                </details>
                <details class="tm-faq">
                    <summary>¿Puedo guardar mi resultado?</summary>
                    <p>Puede tomar una captura o anotar su puntaje. Si lo desea, compártalo en su cita.</p>
                </details>
                <details class="tm-faq">
                    <summary>¿Qué hago si obtengo un puntaje elevado?</summary>
                    <p>Le sugerimos agendar una sesión. Estamos para acompañarle con un plan a su medida.</p>
                </details>
            </div>
        </div>
    </div>
</section>

<!-- ====== CTA final ====== -->
<section id="cta-test">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h2 class="white" style="margin:0 0 10px;">¿Desea conversar con un profesional?</h2>
                <p class="white" style="opacity:.9;">Agende una cita y construyamos juntos un plan de bienestar.</p>
                <a href="@Url.Action("Citas","Home")" class="btn btn-appoint" style="margin-top:10px;">Agendar cita</a>
            </div>
        </div>
    </div>
</section>

<!-- ====== Script: flecha/btn hacen scroll al CENTRO + lógica del test ====== -->
<script>
  document.addEventListener('DOMContentLoaded', function(){
    function scrollToCenter(selector){
      var target = document.querySelector(selector);
      if (!target) return;
      var header = document.querySelector('.navbar.navbar-fixed-top');
      var headerH = header ? header.offsetHeight : 0;
      var rect = target.getBoundingClientRect();
      var targetTop = window.pageYOffset + rect.top;
      var centerY = targetTop + (target.offsetHeight / 2) - (window.innerHeight / 2) - headerH;
      var maxY = Math.max(0, document.documentElement.scrollHeight - window.innerHeight);
      var finalY = Math.min(Math.max(0, centerY), maxY);
      window.scrollTo({ top: finalY, behavior: 'smooth' });
      target.setAttribute('tabindex', '-1');
      try { target.focus({ preventScroll: true }); } catch(e) {}
    }

    var triggers = document.querySelectorAll('#banner .overlay-detail a[href^="#"], #banner .btn-appoint[href^="#"]');
    for (var i=0; i<triggers.length; i++){
      triggers[i].addEventListener('click', function(e){
        var href = this.getAttribute('href') || '';
        if (href.startsWith('#')){ e.preventDefault(); scrollToCenter(href); }
      });
    }

    // Lógica del test
    var form = document.getElementById('formTest');
    var progressBar = document.getElementById('tm-progress-bar');
    var progressText = document.getElementById('tm-progress-text');
    var resultBox = document.getElementById('tm-result');
    var scoreSpan = document.getElementById('tm-score');
    var levelSpan = document.getElementById('tm-level');
    var recoDiv = document.getElementById('tm-reco');

    function totalQuestions(){ return form.querySelectorAll('fieldset[data-q]').length; }
    function answered(){ return form.querySelectorAll('input[type="radio"]:checked').length; }

    form.addEventListener('change', function(){
      var pct = Math.round((answered() / totalQuestions()) * 100);
      progressBar.style.width = pct + '%';
      progressText.textContent = pct + '%';
    });

    form.addEventListener('submit', function(e){
      e.preventDefault();
      var t = totalQuestions();
      var a = answered();
      if (a < t){
        alert('Por favor, responda todas las preguntas (' + a + '/' + t + ').');
        return;
      }
      var sum = 0;
      for (var i=1; i<=t; i++){
        var sel = form.querySelector('input[name="q'+i+'"]:checked');
        sum += parseInt(sel.value, 10);
      }
      // Nivel
      var level = 'Bajo', badgeClass = 'badge-low', reco = 'Señales leves. Mantenga hábitos de autocuidado y rutinas saludables.';
      if (sum >= 8 && sum <= 15){ level = 'Moderado'; badgeClass = 'badge-mod'; reco = 'Considere apoyo profesional para explorar estrategias y seguimiento.'; }
      if (sum >= 16){ level = 'Elevado'; badgeClass = 'badge-high'; reco = 'Recomendamos evaluación clínica para un plan de apoyo personalizado.'; }

      scoreSpan.textContent = sum;
      levelSpan.textContent = level;
      levelSpan.className = 'tm-badge ' + badgeClass;
      recoDiv.textContent = reco;

      resultBox.style.display = 'block';
      // Desplaza a resultados para que queden a la vista
      scrollToCenter('#tm-result');
    });

    document.getElementById('btnReset').addEventListener('click', function(){
      form.reset();
      progressBar.style.width = '0%';
      progressText.textContent = '0%';
      resultBox.style.display = 'none';
    });
  });
</script>
